<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script src="./js/Crossworder.js"></script>

<style>
.center {
    text-align: center;
    margin: auto;
    width: 70%;
    padding: 10px;
    float:center;
}

.crosswordTable {
    border: 3px solid #73AD21;
}
</style>


<title>Test wordplacer</title>
</head>
<script>
function place()
{
    var descr = document.getElementById("crosswords");
    while (descr.childNodes.length > 0) {
        descr.removeChild(descr.childNodes[0]);
    }
    descr = document.getElementById("description");
    while (descr.childNodes.length > 0) {
        descr.removeChild(descr.childNodes[0]);
    }

    setTimeout(function() 
    		{
    
			    //["АЛЬКОР", "ТРУБА", "ОСЬМИЗНАК", "ВЕНТИЛЯТ", "грымза", "два", "крыша", "СЕМЕНЫЧ", "ЯБЛОКО", "НЕМЕЦ", "УХО", "КНИГА", "ВЕТЕР", "ОКНО", "СИНИЙ"]
			    //АЛЬКОР, ТРУБА, ОСЬМИЗНАК, ВЕНТИЛЯТ, грымза, два, крыша, СЕМЕНЫЧ, ЯБЛОКО, НЕМЕЦ, УХО, КНИГА, ВЕТЕР, ОКНО, СИНИЙ
			    let matrixSize = parseInt(document.getElementById("matrixSize").value, 10);
			    let trials = parseInt(document.getElementById("trials").value, 10);
			    let wordsList = Crossworder.prepareWordsList(document.getElementById("wordsList").value);
			    let rotations = [];
			    Object.keys(Crossworder.Rotations).forEach( function(item, index, array) {
			    	let chb = document.getElementById(item);
			    	if( chb !== undefined && chb.checked ) {
			    		rotations.push(item);
			    	}
			    } );
			    
			    
			    var result = Crossworder.placeWords(wordsList, rotations, matrixSize);
			    for ( let idx=0; idx<trials; idx++ ) 
			    {
			    	let tmpResult = Crossworder.placeWords(wordsList, rotations, matrixSize);
			    	if( result.placed.length < tmpResult.placed.length ) {
			    		result = tmpResult;
			    	}
			    	document.getElementById("trials").value = trials - idx;
			    }
			    
			    document.getElementById("trials").value = trials;
			       
			    // print result matrix for debug purposes
			    var container = document.getElementById('crosswords');
			    var table = document.createElement("table");
			    table.classList.add("crosswordTable");
			    for( let idx=0; idx < result.matrix.length; idx++ ) 
			    {
			        var tr = document.createElement("tr")
			        for( let idy=0; idy < result.matrix[idx].length; idy++ ) 
			        {
			            var td = document.createElement("td");
			            td.innerHTML = result.matrix[idx][idy];
			            tr.appendChild(td);
			        }
			        //document.write("</tr>");
			        table.appendChild(tr);
			    }
			    
			    //document.write("</table>");
			    container.appendChild(table);
			
			    
			    
			    var descr = document.getElementById("description");
			    while (descr.childNodes.length > 0) {
			    	descr.removeChild(descr.childNodes[0]);
			    }
			    descr.appendChild((function (){ let tmp = document.createElement("p"); tmp.innerHTML = "<b>Слов размещено " + result.placed.length + "</b>: " + result.placed.sort().join(", "); return tmp; })());
			    descr.appendChild((function (){ let tmp = document.createElement("p"); tmp.innerHTML = "<b>Слов не размещено " + result.notPlaced.length + "</b>: " + result.notPlaced.sort().join(", "); return tmp; })());
    }, 100);
}
</script>
<body>

<div style="width:70%;float:center" id="content">
    <div style="width:50%;float:left;border:1;background-color:light-gray" id="settings">
		<p>
		Список слов, разделенных запятой, для размещения:<br/> 
		<textarea rows="5" cols="30" id="wordsList" required></textarea><br /><br />
		Размер таблицы (по-умолчанию 8):  
		<input type="number" id="matrixSize" size="3" value="8" required><br /><br />
		
        Количество попыток размещения (по-умолчанию 50):  
        <input type="number" id="trials" size="3" value="50" required><br /><br />
        
        <fieldset id="rotations">
            <legend>Использовать направления:</legend>
<script type="text/javascript">
    Object.keys(Crossworder.Rotations).forEach( function(item, index, array) {
        document.write("<input type=\"checkbox\" checked=true value=" + item + " id=\"" + item + "\">" + Crossworder.Rotations[item].name + "(" + Crossworder.Rotations[item].icon + ")<br />");
    } );
</script>  
        </fieldset><br /><br />
        
		<input type="button" onclick = "place()" value="Старт">		
    </div>
	<div style="width:50%;float:right" id="results">
		<div id="crosswords" class="center"></div>
		<div id="description"></div>
	</div>
</div>

</body>
<script type="text/javascript">document.getElementById("wordsList").value="АЛЬКОР, ТРУБА, ОСЬМИЗНАК, ВЕНТИЛЯТ, грымза, два, крыша, СЕМЕНЫЧ, ЯБЛОКО, НЕМЕЦ, УХО, КНИГА, ВЕТЕР, ОКНО, СИНИЙ";</script>

</html>