<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script src="./js/Crossworder.js"></script>

<style>
.center {
    text-align: center;
    margin: auto;
    width: 70%;
    left: 15%;
    padding: 10px;
    float:center;
}

.crosswordTable {
    border: 1px solid black;
    width:200px;
    height:200px;
    margin: auto;
}

div.content
{
    position:absolute;
    width:70%;
    max-width:100%;
    left:15%;
    background-color:#ccffff;
}

div.settings
{
    width:100%;
    left:0pt;
    top:0;
    background-color:#f2f2f2;
    float:left;
    padding: 5px;
    -moz-box-sizing: border-box; 
    -webkit-box-sizing: border-box; 
     box-sizing: border-box; 
}

div.results
{
    top:0;
    width:100%;
    #background-color:yellow;
    top:0;
    padding: 20px;
    -moz-box-sizing: border-box; 
    -webkit-box-sizing: border-box; 
    box-sizing: border-box; 
}
.innerbox
{
    width:50%;
    padding:0;
}
.innerbox.left
{
    float:left;
}
.innerbox.right
{
    float:right;
}

body, html {
  height: 100%;
}

</style>


<title>Test wordplacer</title>
</head>
<body>

<div class="content" id="content">
    <div class="innerbox" style="float:left">
	    <div class="settings" id="settings">
	       <fieldset id="settings" style="width:90%;padding:10px;">
                <legend>Настройки:</legend>
				<p>
				Список слов, разделенных запятой, для размещения:<br/> 
				<textarea rows="5" cols="30" id="wordsList" required style="width:95%;max-width:95%;min-width:10%;"></textarea><br /><br />
				Размер таблицы (по-умолчанию 8):
                <input type="number" id="matrixSize" size="3" value="8" required style="width:50px"><br /><br />
		        Количество попыток размещения:  
		        <input type="number" id="trials" size="3" value="50" required><br />
		        
		        <fieldset id="rotations" style="width:90%">
		            <legend>Использовать направления:</legend>
					<script type="text/javascript">
					    Object.keys(Crossworder.Rotations).forEach( function(item, index, array) {
					        document.write("<input type=\"checkbox\" checked=true value=" + item + " id=\"" + item + "\">(" + Crossworder.Rotations[item].icon + ") " + Crossworder.Rotations[item].name + "<br />");
					    } );
					</script>  
		        </fieldset>
	        </fieldset>
	        <br />
			<div style="text-align:center;"><input type="button" onclick = "place()" value="Старт" style="width:50%;" align="center"></div>		
	    </div>
    </div>
    <div class="innerbox left">
        <fieldset id="settings" style="width:90%">
            <legend>Результат:</legend>
			<div class="results" id="results">
				<div id="crosswords" class="center"></div>
	            <div id="description"></div>
			</div>
		</fieldset>
	</div>
</div>

</body>
<script type="text/javascript">//document.getElementById("wordsList").value="АЛЬКОР, ТРУБА, ОСЬМИЗНАК, ВЕНТИЛЯТ, грымза, два, крыша, СЕМЕНЫЧ, ЯБЛОКО, НЕМЕЦ, УХО, КНИГА, ВЕТЕР, ОКНО, СИНИЙ";</script>
<script>
function place()
{
    var descr = document.getElementById("crosswords");
    while (descr.childNodes.length > 0) {
        descr.removeChild(descr.childNodes[0]);
    }
    descr = document.getElementById("description");
    while (descr.childNodes.length > 0) {
        descr.removeChild(descr.childNodes[0]);
    }

    // launching placement wit hsome delay to give browser time to render screen  
    setTimeout(function() {
                //["АЛЬКОР", "ТРУБА", "ОСЬМИЗНАК", "ВЕНТИЛЯТ", "грымза", "два", "крыша", "СЕМЕНЫЧ", "ЯБЛОКО", "НЕМЕЦ", "УХО", "КНИГА", "ВЕТЕР", "ОКНО", "СИНИЙ"]
                //АЛЬКОР, ТРУБА, ОСЬМИЗНАК, ВЕНТИЛЯТ, грымза, два, крыша, СЕМЕНЫЧ, ЯБЛОКО, НЕМЕЦ, УХО, КНИГА, ВЕТЕР, ОКНО, СИНИЙ
                let matrixSize = parseInt(document.getElementById("matrixSize").value, 10);
                let trials = parseInt(document.getElementById("trials").value, 10);
                let wordsList = Crossworder.prepareWordsList(document.getElementById("wordsList").value);
                
                // check what rotations user selected
                let rotations = [];
                Object.keys(Crossworder.Rotations).forEach( function(item, index, array) {
                    let chb = document.getElementById(item);
                    if( chb !== undefined && chb.checked ) {
                        rotations.push(item);
                    }
                } );
             
                //placing words selected amount of times
                var result = Crossworder.placeWords(wordsList, rotations, matrixSize);
                for ( let idx=0; idx<trials; idx++ ) 
                {
                    let tmpResult = Crossworder.placeWords(wordsList, rotations, matrixSize);
                    if( result.placed.length < tmpResult.placed.length ) {
                        result = tmpResult;
                    }
                }
                   
                // print result matrix for debug purposes
                Crossworder.fillGaps(result.matrix, "АБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ".split(""));
                var container = document.getElementById('crosswords');
                var table = document.createElement("table");
                table.classList.add("crosswordTable");
                for( let idx=0; idx < result.matrix.length; idx++ ) 
                {
                    var tr = document.createElement("tr")
                    for( let idy=0; idy < result.matrix[idx].length; idy++ ) 
                    {
                        var td = document.createElement("td");
                        td.innerHTML = result.matrix[idx][idy];
                        tr.appendChild(td);
                    }
                    //document.write("</tr>");
                    table.appendChild(tr);
                }
                
                //document.write("</table>");
                container.appendChild(table);
            
                
                
                var descr = document.getElementById("description");
                while (descr.childNodes.length > 0) {
                    descr.removeChild(descr.childNodes[0]);
                }
                descr.appendChild((function (){ let tmp = document.createElement("p"); tmp.innerHTML = "<b>Слов размещено " + result.placed.length + "</b>: " + result.placed.sort().join(", "); return tmp; })());
                descr.appendChild((function (){ let tmp = document.createElement("p"); tmp.innerHTML = "<b>Слов не размещено " + result.notPlaced.length + "</b>: " + result.notPlaced.sort().join(", "); return tmp; })());
    }, 100);
}
</script>

</html>
